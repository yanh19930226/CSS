搭建本地单机K8S环境
石墨文档地址：https://shimo.im/docs/Ji1cdlgJKAUJWx3L/read
文章地址：https://yq.aliyun.com/articles/508460

1.chocolatey包管理器安装(Todo:科学上网加速)
以管理员身份运行cmd，安装chocolatey：
@"%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe" -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command "iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))" && SET "PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey\bin"
报错解决方案：
直接打开网址：https://chocolatey.org/install.ps1
右键另存为install.ps1文件
以管理员运行cmd，切换到下载的install.ps1所在目录，运行下面代码：
@powershell -NoProfile -ExecutionPolicy Bypass -Command "iex ((New-Object System.Net.WebClient).DownloadString('install.ps1'))" && SET "PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey\bin"
使用 choco -V 检查是否安装成功
2.安装wget
choco install wget
使用 wget -V 检查是否安装成功

文章链接：https://blog.csdn.net/qq_43650934/article/details/106637645

2.安装kuberctl
3.从阿里云镜像服务下载Kubernetes安装所需Docker镜像:git clone https://github.com/AliyunContainerService/k8s-for-docker-desktop,需要根据k8s的对应版本下载对应的仓库
4.管理员打开powershell,设置powershell的安全级别
  如果因为安全策略无法执行 PowerShell 脚本，请在 “以管理员身份运行” 的 PowerShell 中执行 Set-ExecutionPolicy RemoteSigned 命令
5.powershell中执行： .\load_images.ps1;docker 启动日志在:C:ProgramDataDockerDesktopservice.txt 
6.k8s控制台使用Token令牌方式登入
  # 创建dashboard管理用户
  kubectl create serviceaccount dashboard-admin -n kube-system

  # 绑定用户为集群管理用户
  kubectl create clusterrolebinding dashboard-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin

  # 生成tocken
  kubectl describe secret -n kube-system dashboard-admin-token
  
  
  
  centos单价搭建Kubernetes
  1.yum update -y && yum install wget vim -y
  2.wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O/etc/yum.repos.d/docker-ce.repo
    yum -y install docker-ce
    systemctl enable docker
    systemctl start docker
  3.systemctl stop firewalld
  4.关闭所有节点的SELinux
    永久方法 – 需要重启服务器
    修改/etc/selinux/config文件中设置SELINUX=disabled
  5.swapoff -a
  6.cat>>/etc/yum.repos.d/kubrenetes.repo<<EOF

[kubernetes]

name=Kubernetes Repo

baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/

gpgcheck=0

gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg

EOF
7.yum install -y kubeadm  kubelet kubectl
  systemctl enable kubelet.service
8.kubeadm init --image-repository registry.aliyuncs.com/google_containers --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors=cri --kubernetes-version=1.17.3
9.error 
  kubernetes the connection to the server 8080 was refused 1.13
  自动检测
  $ mkdir -p $HOME/.kube
  $ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  $ sudo chown $(id -u):$(id -g) $HOME/.kube/config
10.kubeadm token create --print--join-command
  
